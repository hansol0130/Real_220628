USE [JGHotel]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_COM_QNA_LIST]
	@CONSULT_CD VARCHAR(10),
	@TOPCOUNT INT,
	@SEARCHTYPE VARCHAR(8),
	@SEARCHKEY VARCHAR(32)
AS

/*
	USP_COM_QNA_LIST 'D', '20', '', ''
*/

DECLARE @SEARCH VARCHAR(MAX)
SET @SEARCH = ''

IF (LEN(@SEARCHTYPE) > 0 AND LEN(@SEARCHKEY) > 0)
	BEGIN
		IF (@SEARCHTYPE = 'ALL')
		BEGIN
			SET @SEARCH = ' AND (ASK_TITLE LIKE ''%' + @SEARCHKEY + '%'' OR ASK_DESC LIKE ''%' + @SEARCHKEY + '%'')'
		END
		ELSE IF (@SEARCHTYPE = 'WRITER')
		BEGIN
			SET @SEARCH = ' AND INS_EMP_NO LIKE ''%' + @SEARCHKEY + '%'' '
		END
		ELSE IF (@SEARCHTYPE = 'TITLE')
		BEGIN
			SET @SEARCH = ' AND ASK_TITLE LIKE ''%' + @SEARCHKEY + '%'' '
		END
	END

DECLARE @SQL VARCHAR(MAX)
	BEGIN
		SET @SQL = 'SELECT TOP ' + CONVERT(VARCHAR, @TOPCOUNT) + ' *, REPLACE(CONVERT(VARCHAR, CONVERT(DATETIME, INS_DT), 111), ''/'', ''-'') AS INS_DT2 FROM COM_QNA
		WHERE CONSULT_CD = ''' + @CONSULT_CD + ''' ' + @SEARCH + ' ORDER BY CONSULT_SEQ DESC '
	END

PRINT @SQL
EXEC (@SQL)


GO
