USE [JGHotel]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_BATCH_KEYWORD_CITY]

/*
USP_BATCH_KEYWORD_CITY 100
*/

@TOP INT

AS

SELECT *, RANK() OVER (PARTITION BY CITY_NAME ORDER BY HTL_CNT DESC) AS SORT
INTO #TMP_TABLE
FROM (
	SELECT A.CITY_CODE, A.CITY_NAME, COUNT(*) AS HTL_CNT
	FROM HTL_CODE_MAST_CITY A
	JOIN HTL_INFO_MAST_HOTEL B ON A.CITY_CODE=B.CITY_CODE
	WHERE A.USE_YN='Y' AND NATION_CODE <> 'KR'
	GROUP BY A.CITY_CODE, A.CITY_NAME
) A

SELECT TOP (@TOP) A.CITY_CODE, A.CITY_NAME, SORT, SORT_ORDER, HTL_CNT
FROM HTL_CODE_MAST_CITY A
JOIN #TMP_TABLE B ON A.CITY_CODE=B.CITY_CODE 
ORDER BY SORT, SORT_ORDER, HTL_CNT DESC


GO
