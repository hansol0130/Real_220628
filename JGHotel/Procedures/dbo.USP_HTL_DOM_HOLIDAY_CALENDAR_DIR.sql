USE [JGHotel]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_HTL_DOM_HOLIDAY_CALENDAR_DIR]  
  
/*  
[USP_HTL_DOM_HOLIDAY_CALENDAR_DIR] '<ArrayOfDZ><DZ><CD>2015-05-01</CD></DZ><DZ><CD>2015-05-02</CD></DZ><DZ><CD>2015-05-03</CD></DZ><DZ><CD>2015-05-04</CD></DZ><DZ><CD>2015-05-05</CD></DZ><DZ><CD>2015-05-06</CD></DZ><DZ><CD>2015-05-07</CD></DZ><DZ><CD>2015

-05-08</CD></DZ><DZ><CD>2015-05-09</CD></DZ><DZ><CD>2015-05-10</CD></DZ><DZ><CD>2015-05-11</CD></DZ><DZ><CD>2015-05-12</CD></DZ><DZ><CD>2015-05-13</CD></DZ><DZ><CD>2015-05-14</CD></DZ><DZ><CD>2015-05-15</CD></DZ><DZ><CD>2015-05-16</CD></DZ><DZ><CD>2015-05

-17</CD></DZ><DZ><CD>2015-05-18</CD></DZ><DZ><CD>2015-05-19</CD></DZ><DZ><CD>2015-05-20</CD></DZ><DZ><CD>2015-05-21</CD></DZ><DZ><CD>2015-05-22</CD></DZ><DZ><CD>2015-05-23</CD></DZ><DZ><CD>2015-05-24</CD></DZ><DZ><CD>2015-05-25</CD></DZ><DZ><CD>2015-05-26

</CD></DZ><DZ><CD>2015-05-27</CD></DZ><DZ><CD>2015-05-28</CD></DZ><DZ><CD>2015-05-29</CD></DZ><DZ><CD>2015-05-30</CD></DZ><DZ><CD>2015-05-31</CD></DZ></ArrayOfDZ>'  
*/  
    
@XML VARCHAR(MAX)    

 
AS  
  
DECLARE @XML_DOCUMENT_HANDLE INT;    
DECLARE @XML_DOCUMENT VARCHAR(MAX);    
SET @XML_DOCUMENT = '<?xml version="1.0" encoding="euc-kr"?>' + @XML       
                    
EXEC SP_XML_PREPAREDOCUMENT @XML_DOCUMENT_HANDLE OUTPUT, @XML_DOCUMENT      
                    
                    
--요금 임시저장                    
                    
SELECT *               
INTO #TMP_TABLE            
FROM OPENXML (@XML_DOCUMENT_HANDLE, '/ArrayOfDZ/DZ',2)                     
WITH (      
     CAL_DATE varchar(10) './CD'  
) A    
    
  
SELECT A.CAL_DATE,
B.WEEK_DAY,
B.DATE_DESC
FROM #TMP_TABLE A
LEFT JOIN TBL_CODE_HOLIDAY B ON DATE_DESC NOT IN ('토요일', '일요일') AND A.CAL_DATE=B.TARGET_DATE
ORDER BY A.CAL_DATE ASC
  
    
EXEC SP_XML_REMOVEDOCUMENT @XML_DOCUMENT_HANDLE
GO
