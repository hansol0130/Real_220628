USE [JGHotel]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_HTL_IDX_CITY_RECOM]

/*
USP_HTL_IDX_CITY_RECOM
*/

AS

SELECT REGION_CODE, A.REGION_NAME, 
A.NATION_CODE, A.NATION_NAME, A.NATION_ENAME,
A.CITY_CODE, A.CITY_NAME, A.CITY_ENAME
FROM (
	SELECT B.REGION_CODE, B.REGION_NAME, 
	B.NATION_CODE, B.NATION_NAME, B.NATION_ENAME,
	A.CITY_CODE, A.CITY_NAME, A.CITY_ENAME,
	RANK() OVER (PARTITION BY REGION_CODE ORDER BY A.SORT_ORDER, A.CITY_CODE) AS SORT
	FROM HTL_CODE_MAST_CITY A
	JOIN HTL_CODE_MAST_NATION B ON A.NATION_CODE=B.NATION_CODE
	WHERE A.SORT_ORDER < 99999 AND --A.NATION_CODE <> 'KR' AND 
	A.MAIN_YN='Y'
) A
JOIN DBO.fn_Split('KOR|ASIA|JPN|CHI|AMCA|EUR', '|') B ON A.REGION_CODE=B.VALUE
ORDER BY B.IDX, A.SORT
GO
