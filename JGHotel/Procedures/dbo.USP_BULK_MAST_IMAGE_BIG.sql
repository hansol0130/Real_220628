USE [JGHotel]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROC [dbo].[USP_BULK_MAST_IMAGE_BIG]

/*
USP_BULK_MAST_IMAGE_BIG '<XML />'
*/

@XML VARCHAR(MAX)

AS

DECLARE @XML_DOCUMENT_HANDLE INT;
DECLARE @XML_DOCUMENT VARCHAR(MAX);
SET @XML_DOCUMENT = '<?xml version="1.0" encoding="euc-kr"?>' + @XML

EXEC SP_XML_PREPAREDOCUMENT @XML_DOCUMENT_HANDLE OUTPUT,  @XML_DOCUMENT

SELECT *
INTO #TMP_TABLE
FROM OPENXML (@XML_DOCUMENT_HANDLE,  '/ArrayOfMastImageRS/MastImageRS', 2)                 
WITH (  
	IMG_NO VARCHAR(1000) './ImgNo',
	IMG_URL VARCHAR(1000) './ImgUrl'
) A


UPDATE HTL_INFO_MAST_IMAGE SET IMG_URL=A.IMG_URL, IMG_Z=A.IMG_URL, UPDATE_DATE=GETDATE()
FROM #TMP_TABLE A
JOIN HTL_INFO_MAST_IMAGE B ON A.IMG_NO=B.IMG_NO


EXEC SP_XML_REMOVEDOCUMENT @XML_DOCUMENT_HANDLE 
GO
