USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO







CREATE VIEW [dbo].[VIEW_PRO_MASTER] AS

SELECT MASTER_CODE, MASTER_NAME, 'P' AS [FLAG], ATT_CODE, SIGN_CODE
	, STUFF((
		SELECT ('|' + BB.NATION_CODE ) AS [text()]
		FROM PKG_MASTER_SCH_CITY AA  WITH(NOLOCK) INNER JOIN PUB_CITY BB  WITH(NOLOCK) ON AA.CITY_CODE = BB.CITY_CODE
		WHERE AA.MASTER_CODE = A.MASTER_CODE --AND AA.MAINCITY_YN = 'Y'
		GROUP BY BB.NATION_CODE FOR XML PATH('')
	), 1, 1, '') AS [NATION_CODE]
	, STUFF((
		SELECT ('|' + CITY_CODE ) AS [text()]
		FROM PKG_MASTER_SCH_CITY WITH(NOLOCK) 
		WHERE MASTER_CODE = A.MASTER_CODE --AND MAINCITY_YN = 'Y'
		GROUP BY CITY_CODE FOR XML PATH('')
	), 1, 1, '') AS [CITY_CODE]
FROM PKG_MASTER A WITH(NOLOCK) 
UNION ALL
SELECT MASTER_CODE, MASTER_NAME, 'H' AS [FLAG], 'Z' AS [ATT_CODE], B.[SIGN], A.NATION_CODE, A.CITY_CODE
FROM HTL_MASTER A WITH(NOLOCK) 
INNER JOIN PUB_REGION B  WITH(NOLOCK) ON A.REGION_CODE = B.REGION_CODE





GO
