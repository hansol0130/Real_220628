USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_PRO_GET_ACCOUNT_STATE]
(
	@PRO_CODE VARCHAR(20)
)
RETURNS INT
AS
BEGIN

	-- return 0:미정산, 1: 담당자, 2: 팀장, ... 9:완료
	
	-- 2009-11-09 아래와같이 수정
	-- 정산진행중, 결재진행중, 정산완료, 재정산, 미정산 = 9
	
	DECLARE @ACCOUNT_STATE INT
	
	/* SET_STATE
	0 - 정산진행중
	1 - 결재진행중
	2 - 정산완료
	3 - 재정산 */

	SELECT @ACCOUNT_STATE = ISNULL((SELECT SET_STATE FROM SET_MASTER WITH(NOLOCK) WHERE PRO_CODE = @PRO_CODE), 9)

	--SELECT @ACCOUNT_STATE = (
	--	CASE (SELECT SET_STATE FROM SET_MASTER WHERE PRO_CODE = @PRO_CODE)
	--		WHEN 0 THEN 1
	--		WHEN 1 THEN 2
	--		WHEN 2 THEN 9
	--		WHEN 3 THEN 1
	--		ELSE 0
	--	END
	--)

	RETURN (@ACCOUNT_STATE)

END
GO
