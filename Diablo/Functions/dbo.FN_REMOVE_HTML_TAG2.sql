USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/* 2010-09-01 인코딩된 HTML 태그 제거 함수  &lt; , &gt;
작성자:박형만 
*/
CREATE FUNCTION [dbo].[FN_REMOVE_HTML_TAG2]
(
	@CONTENTS VARCHAR(8000)
)
RETURNS VARCHAR(8000)
AS
BEGIN

	--declare @CONTENTS varchar(8000)
	--SET @CONTENTS = 'AAAAB&lt;12345&gt;BBBBB&lt;123&gt;CCCCCC'
	IF( @CONTENTS IS NULL ) 
		RETURN NULL 
		
	DECLARE @TAG_LEN INT 
	DECLARE @CNT INT 
	SET @CNT = 0
	WHILE CHARINDEX( '&lt;',@CONTENTS)  > 0 
	BEGIN
		IF( @CNT > 50000)
		BEGIN
			BREAK
		END 
		SET @TAG_LEN =  CHARINDEX( '&gt;',@CONTENTS) - CHARINDEX( '&lt;',@CONTENTS) + 4 
		IF( @TAG_LEN < 0 )
		BEGIN
			BREAK 
		END 
		SET @CONTENTS =  STUFF( @CONTENTS ,CHARINDEX( '&lt;',@CONTENTS) , @TAG_LEN ,'')
		
		SET @CNT = @CNT + 1 
	END 
	RETURN @CONTENTS 
END

GO
