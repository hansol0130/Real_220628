USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE FUNCTION [dbo].[FN_RES_FIT_GET_PAY_STATE]
(
	@GRP_RES_CODE	VARCHAR(20),
	@FLAG			INT
)
RETURNS INT
AS
BEGIN

	DECLARE @TOT_PRICE INT, @PAY_PRICE INT, @PAY_STATE INT

	-- TOT_PRICE는 판매액
	SELECT @TOT_PRICE = DBO.FN_RES_FIT_GET_TOTAL_PRICE(@GRP_RES_CODE, @FLAG)

	-- PAY_PRICE는 입금액
	SELECT @PAY_PRICE = DBO.FN_RES_FIT_GET_PAY_PRICE(@GRP_RES_CODE, @FLAG)

	SELECT @PAY_STATE = (
		CASE
			WHEN @PAY_PRICE = 0 THEN 0				-- 미납
			WHEN @TOT_PRICE > @PAY_PRICE THEN 1		-- 부분납
			WHEN @TOT_PRICE = @PAY_PRICE THEN 2		-- 완납
			WHEN @TOT_PRICE < @PAY_PRICE THEN 3		-- 과납
		END
	)

	RETURN (@PAY_STATE)

END
GO
