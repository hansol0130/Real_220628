USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*================================================================================================================
■ USP_NAME					: SP_MOV2_RESERVE_AIR_CUSTOMER_SELECT
■ DESCRIPTION				: 검색_항공출발자
■ INPUT PARAMETER			: RES_CODE
■ EXEC						: 
    -- EXEC SP_MOV2_RESERVE_AIR_CUSTOMER_SELECT 'RP1703032908'

■ MEMO						: 항공 출발자 정보를 가져온다.
------------------------------------------------------------------------------------------------------------------
■ CHANGE HISTORY                   
------------------------------------------------------------------------------------------------------------------
   DATE				AUTHOR			        DESCRIPTION           
------------------------------------------------------------------------------------------------------------------
   2017-08-02		오준욱(IBSOLUTION)		최초생성
   2017-10-11		김성호					쿼리 수정
================================================================================================================*/ 
CREATE PROCEDURE [dbo].[SP_MOV2_RESERVE_AIR_CUSTOMER_SELECT]
	@RES_CODE		VARCHAR(20)
AS
BEGIN

	SELECT
		A.RES_CODE, A.SEQ_NO, A.CUS_NAME, A.GENDER, A.LAST_NAME, A.FIRST_NAME
		, B.BIRTH_DAY, C.BIRTH_DATE
		, (A.SALE_PRICE - A.DC_PRICE + A.CHG_PRICE + A.PENALTY_PRICE) AS SALE_SUM_PRICE	   --요금
		, A.SALE_PRICE
		, A.CHG_PRICE, A.DC_PRICE
		, A.TAX_PRICE, A.AGE_TYPE
		, (A.SALE_PRICE - A.DC_PRICE + A.CHG_PRICE + A.TAX_PRICE + A.PENALTY_PRICE) AS TOTAL_PRICE 
		, B.DEP_MILEAGE_REF ,B.DEP_DC_NAME ,B.DEP_DC_RATE
		, B.ARR_MILEAGE_REF, B.ARR_DC_NAME, B.ARR_DC_RATE
		, A.VISA_YN, A.PASS_EXPIRE, A.PASS_ISSUE
		, DAMO.DBO.DEC_VARCHAR('DIABLO', 'DBO.RES_CUSTOMER', 'PASS_NUM', A.SEC_PASS_NUM) AS PASS_NUM
		--, (SELECT TOP 1 TICKET FROM  DSR_TICKET WHERE RES_CODE = A.RES_CODE AND RES_SEQ_NO = A.SEQ_NO)  AS TICKET_NUMBER
		, D.TICKET AS [TICKET_NUMBER]
	FROM RES_CUSTOMER_DAMO A WITH(NOLOCK)
	LEFT JOIN RES_AIR_CUSTOMER_DETAIL B WITH(NOLOCK) ON A.RES_CODE = B.RES_CODE AND A.SEQ_NO = B.SEQ_NO 
	LEFT JOIN CUS_CUSTOMER_DAMO C WITH(NOLOCK) ON A.CUS_NO = C.CUS_NO
	LEFT JOIN DSR_TICKET D WITH(NOLOCK) ON A.RES_CODE = D.RES_CODE AND A.SEQ_NO = D.RES_SEQ_NO
	WHERE A.RES_CODE = @RES_CODE AND A.RES_STATE = 0

	--SELECT
	--	A.RES_CODE, A.SEQ_NO, A.CUS_NAME, A.GENDER, A.LAST_NAME, A.FIRST_NAME
	--	, B.BIRTH_DAY , C.BIRTH_DATE--, A.SOC_NUM1
	--	, (A.SALE_PRICE - A.DC_PRICE + A.CHG_PRICE + A.PENALTY_PRICE) AS SALE_SUM_PRICE	   --요금
	--	, A.SALE_PRICE 
	--	, A.CHG_PRICE , A.DC_PRICE
	--	, A.TAX_PRICE, A.AGE_TYPE
	--	, (A.SALE_PRICE - A.DC_PRICE + A.CHG_PRICE + TAX_PRICE + A.PENALTY_PRICE) AS TOTAL_PRICE 
	--	,  B.DEP_MILEAGE_REF ,B.DEP_DC_NAME ,B.DEP_DC_RATE
	--	,  B.ARR_MILEAGE_REF, B.ARR_DC_NAME, B.ARR_DC_RATE
	--	 , A.VISA_YN  , A.PASS_EXPIRE , A.PASS_ISSUE
	--	, DAMO.DBO.DEC_VARCHAR('DIABLO', 'DBO.RES_CUSTOMER', 'PASS_NUM', A.SEC_PASS_NUM) AS PASS_NUM
	--	,( SELECT TOP 1 TICKET FROM  DSR_TICKET WHERE RES_CODE = A.RES_CODE AND RES_SEQ_NO = A.SEQ_NO )  AS TICKET_NUMBER
	--FROM RES_CUSTOMER_DAMO A WITH(NOLOCK)
	--	LEFT JOIN RES_AIR_CUSTOMER_DETAIL B WITH(NOLOCK)
	--		ON A.RES_CODE = B.RES_CODE 
	--		AND A.SEQ_NO = B.SEQ_NO 
	--	LEFT JOIN CUS_CUSTOMER_DAMO C WITH(NOLOCK)
	--		ON A.CUS_NO = C.CUS_NO
	--WHERE A.RES_CODE =  @RES_CODE
	--AND A.RES_STATE = 0

END           



GO
