USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
CREATE PROCEDURE [dbo].[SP_DOC_REFERENCE_INSERT]
	@EDI_CODE		CHAR(10),
	@REF_CODE		CHAR(7),
	@REF_NAME		VARCHAR(20),
	@NEW_CODE		CHAR(7),
	@NEW_NAME		VARCHAR(20)
AS
BEGIN
	SET NOCOUNT ON;

	-- 중복 방지
	IF NOT EXISTS(SELECT 1 FROM EDI_REFERENCE WHERE EDI_CODE = @EDI_CODE AND REF_CODE = @REF_CODE)
	BEGIN
		DECLARE @SEQ_NO INT

		IF EXISTS(SELECT 1 FROM EDI_REFERENCE WHERE EDI_CODE = @EDI_CODE)
			SELECT @SEQ_NO = (MAX(SEQ_NO) + 1) FROM EDI_REFERENCE WHERE EDI_CODE = @EDI_CODE
		ELSE
			SET @SEQ_NO = 1

		INSERT INTO EDI_REFERENCE (
			EDI_CODE,	SEQ_NO,		REF_CODE,		REF_NAME,		NEW_CODE,			NEW_NAME
		) VALUES (
			@EDI_CODE,	@SEQ_NO,	@REF_CODE,		@REF_NAME,		@NEW_CODE,			@NEW_NAME )
	END

END
GO
