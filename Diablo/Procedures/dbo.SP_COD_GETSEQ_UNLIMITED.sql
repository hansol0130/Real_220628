USE [Diablo]
GO
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO

/*
게시판 번호SEQ 생성
SEQ 제한을 FLAG 값에 따른 9999로 하지 않음 . 무제한 증가 . 게시판 BBS_DETAIL 에서 사용
*/
CREATE PROCEDURE [dbo].[SP_COD_GETSEQ_UNLIMITED]
(
	@COD_TYPE VARCHAR(7),
	@RETURN_CODE VARCHAR(10) OUTPUT
)
 AS
BEGIN 
	SET NOCOUNT OFF;
	BEGIN TRAN

	DECLARE @SEQ INT;

	SELECT TOP 1 @SEQ  = ISNULL(MAX(COD_SQ),0) FROM COD_SEQ  WITH (UPDLOCK) WHERE COD_TYPE =@COD_TYPE

	 IF (@SEQ = 0) 
		BEGIN
			INSERT INTO COD_SEQ (COD_SQ,COD_TYPE, FLAG) VALUES ('0',@COD_TYPE, '2')
			SET @SEQ = 0
		END 

	SET @SEQ = @SEQ + 1;

	UPDATE COD_SEQ SET COD_SQ  = @SEQ WHERE COD_TYPE= @COD_TYPE
	
	SET @RETURN_CODE = @SEQ
	
	COMMIT TRAN
END

GO
